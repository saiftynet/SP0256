# Spoken like a 1980s chip.

### In the beginning

In the beginning there was light.  Of course there was, but a bang must have followed shortly after. It is not unexpected that the communication between organisms, surrounded by a fluid whether it is air or water, is primarily acoustic rather than visual.  While vision remains the king of senses and chemical signals are ubiqitous, interaction using a oscillating pressure producer and a corresponding sensor remains the best compromise to create a versatile rich, abstracted, linear data transfer not requiring line of sight. or any other complex infrastucture apart from a medium that envelops the organism.  Thus, speech.  I recall the early days of my youth my ZXSpectrum had a [Currah Microspeech](https://spectrumcomputing.co.uk/zxsr.php?id=8067) module which, with only a 2K ROM, was able to produce an infinte number of raspy, but mostly recognisable words.  Flash-forwards to today, we have far more powerful utilities producing sounds almost indistinguishable from another human. and Perl allows access to these speech engines.  These are powerful, non-trivial utilities, with superior abilities to change intonnation, speed and other forms of expressive audio manipulations.  For those interested polease explore [PerlSpeak](https://metacpan.org/release/JKAMPHAUS/PerlSpeak-2.01/view/lib/PerlSpeak.pm), [Festival](https://metacpan.org/pod/Speech::Festival::Synthesiser), [e-Speak](https://metacpan.org/pod/Speech::eSpeak).  Perl is certainly not short of vocalising options. 

### Pure Perl Implementation

As an old simpleton, however, I can not drag myself away from the genius of the guys who with such limited resources managed so much, into the modern world were memory and processor power limitations are of no real issue.  The SP0256-AL2 is the centre of this remarkable primitive utility, and I took it myself to explore how this worked, to transform it into a simple module that can be imported into any Perl program, with no dependencies apart from a means to transfer data to a speaker.  There indeed many attempts to emulate this little chip, though I have not come across any that specifically use Perl, I do find resources including this one from [Greg Kennedy](https://github.com/greg-kennedy/p5-NRL-TextToPhoneme) that allow translation to the allphones used here.

### Re-inventing the wheel?

Why do things again that far cleverer people have already done, with far more advanced methods? For sevral reasons.  It helps me learn how things are done. Old methods are not going to be as good as new ones, but use far fewer resources, and this would allow quite a lightweight model for speech synthesis that could be embedded in simple appications and games.  This would not require any installation of any heavy weight baqckends, polluting the system with more and more infrequently usd libraries.   So the "plan" is 1) produce a stand-alone speech systhesis module, 2) progressively make the module more accurate and more recognisable 3) eventually have something anyone can use for fun or for real-life needs.

Now I did make a [Piano-like monophonic player](https://github.com/saiftynet/piano) (Enable the sound in the embedded video sample to hear), based on a memory of a similar utility I saw many years ago. Most web examples use /dev/dsp for audio transfer to the output device, but this virtual interface no longer exists.  A pipe to padsp does allow the emulation of /dev/dsp, and this is what I have used for Linux OS; Win32::Sound has a Windows equivalent of a sink for the raw audio data.

[SP0256.webm](https://user-images.githubusercontent.com/34284663/199564715-6f7166c4-04fb-4ff9-876b-60613887959c.webm)

### Emulation

The classic method for emulation of this appears (as far as I can tell) appears to be record the sounds output from the chip, sampling at much higher frequencies than is output (effectively adding a high pass filter).  This results in errors and distortions.  Such converted data is available as WAV files, and do not have any of the analog filtering that is performed on the original chip, this is actually much lower in quality that the original.  But borrowing this data from various soiurces eneables some semblance of a speech synthesiser, and this modulino represents an early attempt at using unprocessed wave forms. But these wave form are not only innaccurate and noisy compared to the sounds that cane from my 40 year old ZX Spectrum, they take significantly more memory.  The unpacked data in a script ttook 1/2 MB and packed into a Storable file, still take just under 100kb.  Can't see my Speccy being too impressed.

### Missing the point

BUT this simple way belies the cleverness of the original chip mode of operation.  To understand how this is managed in 2kb of ROM one has to explore the disassembly of this ingenious device. Unlike modern speech synthesisers with banks of pre recorded audio allophones, the SP0256 actually appears to have built the output waveform on the fly *algorithmically*, much the same way as piano.pl generates the raw tone data for each of 96 notes. I do need to pore through this code...to see how this actually works. It should be entirely possible to create an ultra-lightweight module capable of generating recognisable speech in Pure Perl *without* any external speech libraries.

